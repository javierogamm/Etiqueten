<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Etiqueten · Importación de alumnos</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app">
      <header class="hero">
        <div>
          <p class="eyebrow">APP local · Etiquetas por CSV</p>
          <h1>Etiqueten</h1>
          <p class="lead">
            Carga el CSV de alumnos, revisa los datos y genera etiquetas filtradas por NIF con un segundo CSV.
          </p>
        </div>
        <div class="version">Versión <span id="appVersion">0.2.0</span></div>
      </header>

      <section class="card" aria-labelledby="step-1">
        <div class="card-header">
          <span class="step">1</span>
          <div>
            <h2 id="step-1">Carga del CSV de alumnos</h2>
            <p>
              El CSV debe contener las columnas: Promoción CAG, Promoción CAZ, Promoción CGD, Alumno, Estado expediente,
              NIF, Entidad, CIF Entidad, Provincia, DIRECCIÓN COMPLETA, ENVÍO REVISTA, CAG, CAZ, CGD.
            </p>
          </div>
        </div>
        <div class="card-body">
          <label class="file">
            <span>Selecciona el CSV de alumnos</span>
            <input type="file" id="csvPrimary" accept=".csv" />
          </label>
          <p class="hint" id="csvPrimaryStatus">Sin archivo cargado.</p>
          <div class="data-block" id="primaryData" hidden>
            <div class="data-header">
              <h3>Datos importados</h3>
              <span class="pill" id="primaryCount">0 filas</span>
            </div>
            <div class="table-wrap">
              <table id="primaryTable"></table>
            </div>
          </div>
        </div>
      </section>

      <section class="card" aria-labelledby="step-2">
        <div class="card-header">
          <span class="step">2</span>
          <div>
            <h2 id="step-2">Generar etiquetas</h2>
            <p>
              Abre el modal, carga el segundo CSV con NIF y confirma las coincidencias antes de generar el Word.
            </p>
          </div>
        </div>
        <div class="card-body">
          <button class="primary" id="openModal" disabled>Generar etiquetas</button>
        </div>
      </section>
    </main>

    <div class="modal" id="labelsModal" hidden aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <header class="modal-header">
          <div>
            <p class="eyebrow">Paso final</p>
            <h2 id="modal-title">Cruce de NIF y generación de Word</h2>
          </div>
          <button class="icon" id="closeModal" aria-label="Cerrar">×</button>
        </header>
        <div class="modal-body">
          <div class="modal-grid">
            <div>
              <label class="file">
                <span>Sube el CSV de control (Alumno, Estado expediente, NIF)</span>
                <input type="file" id="csvSecondary" accept=".csv" />
              </label>
              <p class="hint" id="csvSecondaryStatus">Sin archivo cargado.</p>
              <div class="summary-grid" id="matchSummary" hidden>
                <div class="summary-card">
                  <h4>Coincidencias</h4>
                  <p id="matchCount">0</p>
                </div>
                <div class="summary-card">
                  <h4>No coinciden</h4>
                  <p id="mismatchCount">0</p>
                </div>
              </div>
            </div>
            <div class="modal-actions">
              <button class="secondary" id="generateWord" disabled>Generar Word</button>
              <button class="ghost" id="downloadPreview" disabled>Previsualizar etiquetas</button>
            </div>
          </div>

          <div class="results" id="matchResults" hidden>
            <h3>Alumnos coincidentes (NIF en verde)</h3>
            <div class="table-wrap">
              <table id="matchesTable"></table>
            </div>
            <h3 class="muted">Alumnos sin coincidencia</h3>
            <div class="table-wrap">
              <table id="mismatchesTable"></table>
            </div>
          </div>

          <section class="preview" id="previewSection" hidden>
            <h3>Vista previa de etiquetas</h3>
            <div id="labelsPreview" class="labels-preview"></div>
          </section>
        </div>
      </div>
    </div>

    <footer class="footer">Hecho para ejecución local · HTML + JS</footer>

    <script src="app.js"></script>
  </body>
</html>
